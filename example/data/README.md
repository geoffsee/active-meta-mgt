# Clinical Datasets

This folder contains datasets used for the active-meta-mgt clinical evaluation example.

## Structure

```
data/
├── patients.csv              # Generated unified dataset
├── reference-ranges.json     # Clinical reference ranges for lab values
├── mimic-iii/               # MIMIC-III Clinical Database Demo
├── source/                  # Raw source datasets from Kaggle
└── reference/               # NHANES and global health reference data
```

## Generated Dataset

### `patients.csv`

Unified patient records combining data from all sources. Generated by `scripts/prepare-dataset.ts`.

| Field | Description |
|-------|-------------|
| patient_id | Unique identifier |
| age, age_bucket, gender | Demographics |
| blood_type | ABO/Rh type |
| primary_diagnosis, icd9_code | Primary condition |
| secondary_diagnoses | Pipe-separated comorbidities |
| condition_category | infectious, cardiac, respiratory, etc. |
| spo2, heart_rate, systolic_bp, diastolic_bp, temperature, respiratory_rate | Vitals |
| hemoglobin, wbc, rbc, platelets, creatinine, lactate, potassium, etc. | Lab values |
| medications | Pipe-separated medication list |
| allergies | Pipe-separated allergy list |
| severity_score | 1-10 severity rating |
| critical_flag | Boolean critical status |

Regenerate with:
```bash
bun run scripts/prepare-dataset.ts
```

## Source Datasets (Kaggle)

All datasets were obtained from [Kaggle](https://www.kaggle.com/) and are used under their respective licenses.

### `mimic-iii/`

**MIMIC-III Clinical Database Demo v1.4**

De-identified ICU patient data from Beth Israel Deaconess Medical Center.

| | |
|---|---|
| **Kaggle** | [asjad99/mimiciii](https://www.kaggle.com/datasets/asjad99/mimiciii) |
| **Original Source** | [PhysioNet](https://physionet.org/content/mimiciii-demo/1.4/) |
| **License** | [PhysioNet Credentialed Health Data License](https://physionet.org/content/mimiciii-demo/1.4/) |
| **Citation** | Johnson, A., Pollard, T., & Mark, R. (2016). MIMIC-III Clinical Database Demo (version 1.4). PhysioNet. |

Key files used:
- `PATIENTS.csv` - Patient demographics
- `ADMISSIONS.csv` - Hospital admissions
- `DIAGNOSES_ICD.csv` - ICD-9 diagnosis codes
- `D_ICD_DIAGNOSES.csv` - ICD-9 code descriptions
- `LABEVENTS.csv` - Laboratory measurements
- `D_LABITEMS.csv` - Lab item definitions
- `CHARTEVENTS.csv` - Vital signs and chart data
- `D_ITEMS.csv` - Chart item definitions
- `PRESCRIPTIONS.csv` - Medication orders

### `source/`

#### Oxygen Dataset Final.csv

**Real-time Patient Data with Oxygen Demand**

| | |
|---|---|
| **Kaggle** | [dibyasankhapal/realtime-patient-data-with-oxygen-demand](https://www.kaggle.com/datasets/dibyasankhapal/realtime-patient-data-with-oxygen-demand) |
| **License** | [CC BY-NC 4.0](https://creativecommons.org/licenses/by-nc/4.0/) |
| **Records** | 200,000 |
| **Fields** | age, gender, spo2, pr (pulse rate), c/nc (critical flag), oxy_flow |

#### healthcare_dataset.csv

**Healthcare Dataset**

| | |
|---|---|
| **Kaggle** | [prasad22/healthcare-dataset](https://www.kaggle.com/datasets/prasad22/healthcare-dataset) |
| **License** | [CC0 1.0 (Public Domain)](https://creativecommons.org/publicdomain/zero/1.0/) |
| **Records** | 55,500 |
| **Fields** | Name, Age, Gender, Blood Type, Medical Condition, Date of Admission, Doctor, Hospital, Insurance Provider, Billing Amount, Room Number, Admission Type, Discharge Date, Medication, Test Results |

#### final_cbc_diagnoses_dataset_with_labels.csv

**Hematology Complete Blood Count Dataset (MIMIC-III)**

| | |
|---|---|
| **Kaggle** | [ashlingovindasamy/hematology-complete-blood-count-dataset-mimic-iii](https://www.kaggle.com/datasets/ashlingovindasamy/hematology-complete-blood-count-dataset-mimic-iii) |
| **License** | [CDLA-Sharing-1.0](https://cdla.dev/sharing-1-0/) |
| **Records** | 1,445 |
| **Fields** | subject_id, CBC values (Hemoglobin, WBC, RBC, Hematocrit, MCV, MCH, MCHC, RDW, Neutrophils, Lymphocytes, Monocytes, Eosinophils, Basophils), gender, dob, dod, short_title, long_title |

### `reference/`

**NHANES (National Health and Nutrition Examination Survey)**

CDC population health data used for deriving reference ranges.

| | |
|---|---|
| **Kaggle** | [kantesti/global-blood-test-health-insights-2025-2026](https://www.kaggle.com/datasets/kantesti/global-blood-test-health-insights-2025-2026) |
| **License** | [CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/) |
| **Source** | CDC NHANES (bundled in Kaggle dataset) |

| File | Description | Records |
|------|-------------|---------|
| `labs.csv` | Laboratory reference values (CBC, BMP, lipids) | 9,813 |
| `demographic.csv` | Population demographics | 9,813 |
| `medications.csv` | Medication usage patterns | - |
| `examination.csv` | Physical examination data | - |
| `diet.csv` | Dietary intake data | - |
| `questionnaire.csv` | Health questionnaire responses | - |
| `kantesti_global_health_insights_2025_2026.csv` | Global health trends by country | - |

## Downloading Datasets

Use the provided download script to fetch all datasets and generate the unified patient data:

```bash
# Install Kaggle CLI
pipx install kaggle

# Configure credentials
# Option 1: Environment variables
export KAGGLE_USERNAME=your_username
export KAGGLE_KEY=your_api_key

# Option 2: Credentials file
# 1. Go to https://www.kaggle.com/settings → API → Create New Token
# 2. Save kaggle.json to ~/.kaggle/kaggle.json
# 3. chmod 600 ~/.kaggle/kaggle.json

# Download and prepare data
cd example
./scripts/download-data.sh
```

The script will:
1. Download all 5 Kaggle datasets (~100MB total)
2. Derive lab reference ranges from NHANES data
3. Generate unified `patients.csv` from all sources

## Data Matching

The `prepare-dataset.ts` script joins datasets using a matching signature:

```
(age_bucket, gender, condition_category)
```

- **Age buckets**: 18-30, 31-45, 46-60, 61-75, 76+
- **Gender**: M/F (normalized)
- **Condition category**: respiratory, cardiac, metabolic, infectious, oncology, neurological, gi, other

This allows combining vitals from the Oxygen dataset, labs from CBC dataset, and demographics from the Healthcare dataset with MIMIC-III clinical records.
